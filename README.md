# SARang Labs - AI 기반 구조-활성 관계 분석 시스템

> **AI 기반 신약 개발을 위한 고도화된 구조-활성 관계(SAR) 분석 및 Activity Cliff 탐지 시스템**

SARang Labs는 신약 개발 과정에서 핵심적인 구조-활성 관계 분석을 자동화하고 지능화하여, 연구자들이 보다 효율적으로 신약 후보 물질을 발견할 수 있도록 돕는 종합 분석 플랫폼입니다.

<br>

## 목차

- [핵심 기능](#핵심-기능)
- [기술 스택](#기술-스택)
- [설치 및 실행](#설치-및-실행)
- [프로젝트 구조](#프로젝트-구조)
- [사용 방법](#사용-방법)
- [데이터 처리 흐름](#데이터-처리-흐름)
- [주요 알고리즘](#주요-알고리즘)
- [프롬프트 엔지니어링](#프롬프트-엔지니어링)
- [프로젝트 기대 효과](#프로젝트-기대-효과)
- [향후 개선 방향](#향후-개선-방향)

<br>

## 핵심 기능

#### Activity Cliff 탐지
- **자동 탐지**: 구조적으로 유사하지만 활성도가 큰 차이를 보이는 화합물 쌍을 자동으로 찾아냄
- **임계값 설정**: 유사도 및 활성도 차이 기준을 조정하여 원하는 조건에 맞는 분석
- **시각적 분석**: 분자 구조의 차이점을 하이라이팅하여 쉽게 확인

#### 정량 분석
- **활성 분류 기반**: 서로 다른 활성 분류를 가진 화합물 쌍의 구조-활성 관계 분석
- **다차원 시각화**: Plotly 기반 인터랙티브 차트로 복잡한 데이터 패턴 시각화
- **통계적 검증**: 과학적 근거에 기반한 정량적 분석 결과 제공

#### AI 전문가 협업 시스템 (Co-Scientist)
- **다각도 전문가 분석**: 구조화학, 생체분자 상호작용, QSAR, 평가 전문가의 협업적 분석
- **LLM 기반 가설 생성**: OpenAI GPT 및 Google Gemini를 활용한 고품질 과학적 가설 생성
- **구조화된 보고서**: 체계적인 분석 리포트 자동 생성

#### 도킹 시뮬레이션 통합
- **타겟 단백질 결합 예측**: 화합물-단백질 상호작용 분석
- **결합 친화도 분석**: 도킹 스코어 기반 활성도 예측
- **3D 시각화**: 분자 결합 양상의 상세한 시각적 분석

#### 분석 이력 관리
- **SQLite 데이터베이스**: 모든 분석 결과의 체계적 저장 및 관리
- **특허 기반 분석**: 특허 번호와 연계한 지적재산권 중심 분석
- **결과 추적**: 과거 분석 결과 조회 및 비교 기능

<br>

## 기술 스택

#### 핵심 프레임워크
- **Python 3.x**: 메인 프로그래밍 언어
- **Streamlit**: 직관적인 웹 인터페이스 프레임워크
- **SQLAlchemy**: 데이터베이스 ORM 및 관리

#### 화학정보학
- **RDKit**: 분자 처리, 핑거프린팅, 구조 분석
- **Tanimoto 유사도**: 분자 구조 유사성 계산
- **SMILES**: 분자 구조 표현 및 처리

#### 데이터 분석 & 시각화
- **pandas/numpy**: 고성능 데이터 처리 및 분석
- **plotly**: 인터랙티브 시각화 및 차트
- **matplotlib**: 정적 시각화 지원

#### AI & 언어모델
- **OpenAI API**: GPT 기반 고급 자연어 처리
- **Google Gemini API**: 다양한 LLM 옵션 제공
- **프롬프트 엔지니어링**: Chain-of-Thought(CoT) 단계별 추론, Few-shot 실제 SAR 사례 학습, Co-Scientist 4개 전문가 에이전트 협업, 할루시네이션 방지 가이드라인

<br>

## 설치 및 실행

### 🌐 온라인 사용
배포된 Streamlit 애플리케이션을 통해 바로 사용할 수 있습니다:
- 웹 브라우저에서 [SARang Labs](링크주소) 접속
- 별도 설치 과정 없이 즉시 분석 시작

### 💻 로컬 설치 및 실행

#### 사전 요구사항
- Python 3.8 이상
- pip 패키지 관리자

#### 1. 저장소 클론
```bash
git clone https://github.com/SARang-Labs/sar-project.git
cd sar-project
```

#### 2. 가상환경 활성화
```bash
# 기존 가상환경 사용 (권장)
source .venv/bin/activate  # macOS/Linux
# 또는
.venv\Scripts\activate  # Windows
```

#### 3. 의존성 설치
```bash
pip install -r requirements.txt
```

#### 4. 애플리케이션 실행
```bash
streamlit run app.py
```

브라우저에서 `http://localhost:8501`로 접속하여 시스템을 사용할 수 있습니다.

<br>

## 프로젝트 구조

```
sar-project/
├── app.py                      # Streamlit 메인 애플리케이션
├── utils.py                    # 핵심 SAR 분석 유틸리티 함수
├── requirements.txt            # Python 패키지 의존성
├── CLAUDE.md                   # 개발 가이드라인
│
├── sar_analysis/               # SAR 분석 핵심 모듈
│   ├── __init__.py
│   ├── experts.py              # AI 전문가 에이전트 클래스
│   ├── llm_client.py           # LLM API 통합 클라이언트
│   └── system.py               # 메인 시스템 로직
│
└── patent_etl_pipeline/        # 특허 데이터 ETL 파이프라인
    ├── database.py             # SQLAlchemy 데이터베이스 모델
    ├── data_processor.py       # 데이터 전처리 모듈
    ├── parsers.py              # 데이터 파싱 유틸리티
    └── run_etl.py              # ETL 파이프라인 실행기
```

<br>

## 사용 방법

#### 1. 데이터 준비
- **특허 번호**: 분석할 특허의 고유 번호 입력
- **타겟 선택**: 분석 대상 단백질 타겟 지정
- **데이터 형식**: ID, SMILES, pIC50 컬럼을 포함한 CSV 파일

#### 2. 분석 유형 선택
- **Activity Cliff 탐지**: 구조 유사성 대비 활성도 차이 분석
- **정량 분석**: 활성 분류 기반 구조-활성 관계 분석

#### 3. 매개변수 설정
- **유사도 임계값**: Tanimoto 유사도 기준 (기본값: 0.7)
- **활성도 차이 임계값**: pIC50 차이 기준 (기본값: 1.0)
- **분석 깊이**: 상위 N개 쌍 분석 범위

#### 4. AI 전문가 협업 실행
- 구조화학 전문가: 분자 구조 분석
- 생체분자 상호작용 전문가: 단백질-리간드 상호작용 분석
- QSAR 전문가: 정량적 구조-활성 관계 분석
- 평가 전문가: 종합적 결과 검증 및 해석

#### 5. 결과 해석
- **시각화된 분자 구조**: 차이점 하이라이팅
- **AI 생성 가설**: 과학적 근거 기반 해석
- **도킹 결과**: 3D 결합 양상 분석
- **구조화된 보고서**: 체계적인 분석 결과

<br>

## 데이터 처리 흐름

1. **데이터 로드**: 특허 데이터베이스에서 화합물 정보 추출
2. **전처리**: SMILES 구조 표준화 및 검증
3. **핑거프린트 생성**: RDKit 기반 분자 핑거프린트 계산
4. **유사도 계산**: Tanimoto 유사도 매트릭스 생성
5. **Activity Cliff 탐지**: 임계값 기반 후보 쌍 식별
6. **AI 분석**: Co-Scientist 방법론 기반 다각도 전문가 시스템 분석
7. **결과 시각화**: 인터랙티브 차트 및 분자 구조 생성
8. **데이터베이스 저장**: 분석 결과 영구 저장 및 이력 관리

<br>

## 주요 알고리즘

#### Activity Cliff 탐지
Tanimoto 유사도와 pIC50 차이를 기반으로 구조적으로 유사하지만 활성도 차이가 큰 화합물 쌍을 식별합니다. 이를 통해 신약 개발에서 중요한 구조-활성 관계의 변곡점을 발견할 수 있습니다.

#### Co-Scientist 전문가 시스템
구조화학, 생체분자 상호작용, QSAR 전문가가 협업하여 Activity Cliff 쌍을 다각도로 분석하고, 과학적 근거에 기반한 가설을 생성합니다. 각 전문가는 특화된 프롬프트를 통해 해당 분야의 전문 지식을 활용합니다.

#### 도킹 시뮬레이션 통합
SwissDock 등의 외부 도킹 도구와 연계하여 타겟 단백질과의 결합 양상을 예측하고, 이를 통해 활성도 차이의 구조적 원인을 규명합니다.

<br>

## 프롬프트 엔지니어링

본 시스템은 SAR 분석의 정확성과 전문성을 확보하기 위해 체계적인 프롬프트 엔지니어링 기법을 적용합니다.

#### 핵심 기법
- **Chain-of-Thought (CoT)**: 단계별 논리적 추론 과정을 통한 체계적 분석
- **Few-shot Learning**: 실제 SAR 분석 사례를 활용한 전문가 지식 전수
- **Co-Scientist 방법론**: 4개 전문 분야 에이전트 간 협업적 분석 체계
  - 구조화학 전문가: 분자 구조 변화 분석
  - 생체분자 상호작용 전문가: 단백질-리간드 결합 메커니즘 분석
  - QSAR 전문가: 정량적 구조-활성 관계 해석
  - 평가 전문가: 종합적 결과 검증 및 품질 보증

#### 품질 보증
- **할루시네이션 방지**: 정량적 예측 제한 및 정성적 분석 중심 가이드라인
- **도메인 특화**: 화학 및 신약 개발 분야 전문 용어와 개념 활용
- **실시간 검증**: 분석 과정에서 논리적 일관성 검토

<br>

## 프로젝트 기대 효과

본 시스템을 통해 기존 수동적 SAR 분석의 한계를 극복하고, AI 기반 전문가 협업으로 보다 객관적이고 체계적인 구조-활성 관계 분석이 가능합니다. Activity Cliff 탐지의 자동화로 연구자들이 놓치기 쉬운 중요한 구조적 변화점을 발견할 수 있으며, 다각도 전문가 분석을 통해 단편적 해석을 넘어선 종합적 가설 생성이 가능합니다. 또한 도킹 시뮬레이션과의 통합으로 실험 데이터와 계산 결과를 연계한 신뢰성 높은 분석 결과를 제공하여, 신약 개발 초기 단계에서의 의사결정 지원 및 연구 효율성 향상에 기여할 것으로 기대됩니다.

<br>

## 향후 개선 방향

#### 도킹 시뮬레이션 개선
- **로컬 도킹 시스템 구축**: 현재 고정된 예시 결과 대신 실제 도킹 계산 수행
- **다중 분자 구조 분석**: 다양한 3D 구조를 고려한 포괄적 도킹 분석
- **결합 양상 비교**: Activity Cliff 쌍 간 단백질 결합 차이점 분석

#### 전문가 토론 시스템 개선
- **상호 소통 구현**: 현재 개별 분석 후 종합하는 방식에서 전문가 간 실제 토론으로 발전
- **동적 의견 교환**: 전문가들이 서로의 의견에 질문하고 반박하는 대화형 분석
- **합의 도출 과정**: 다양한 의견을 조율하여 최종 결론을 도출하는 체계적 과정

#### 시스템 정확도 향상
- **학습 데이터 확장**: 다양한 타겟과 화합물 유형별 전문가 분석 사례 추가
- **검증 체계 강화**: 예측 결과와 실험 데이터 간 일치도 평가 시스템
- **사용자 피드백 반영**: 실제 연구자의 검토 의견을 통한 시스템 개선
